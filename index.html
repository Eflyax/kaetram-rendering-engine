<!DOCTYPE html>
<html lang="cs">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<!-- Import SDK -->
		<script src="https://fc-aml-dev.addaris.toys/sdk/aml-sdk.js" type="module"></script>

		<script>
			// Použití SDK v aplikaci:

			// výpis API odpovědi do stránky
			function printResponse(response) {
				if (response && response.data) {
					console.log({response});
					document.getElementById('result-object').innerHTML = JSON.stringify(response.data, null, 2 );
				}
				else {
					document.getElementById('result-object').innerHTML = '...';
				}
			}

			const
				NAMESPACE = 'aml-test', // libovolný textový řetězec
				USER_ID = 8703298510062447; // ID uživatele

			// DOM a všechny skripty jsou načtené...
			window.addEventListener('load', async() => {
				// Navěšení handleru na tlačítko pro možnost otevřít AML dotazník
				document.getElementById('open-questionnaire').onclick = function(e) {
					window.amlSdk.displayQuestionnaire(`${NAMESPACE}:${USER_ID}`, '--last--', {});
				};

				// Handler pro založení klienta
				document.getElementById('create-client').onclick = async function(e) {
					printResponse();

					const
						clientPayload = {
							id:  new Date().getMilliseconds(), // náhodné ID
							ns: NAMESPACE,
							party: {
								type: 'person',
								person: {
									ownName: 'Garry',
									familyName: 'Gergich',
									title: '',
									nationality: 'AFG',
									nin: '001000110010',
									sex: 'M',
									dateOfBirth: '1987-12-23T00:00:00.000Z',
									placeOfBirth: 'Pawnee',
									contactMethods: [],
									idDocument: {
										type: 'fo_op',
										num: '001001110010',
										issuedBy: 'County of Pawnee',
										validSince: '2011-01-01T00:00:00.000Z',
										validUntil: '2031-01-01T00:00:00.000Z'
									},
									contact: {
										permanentAddress: {
											street: 'R. Bough 666',
											city: 'Pawnee',
											postalCode: '77',
											country: 'USA'
										}
									},
								}
							}
						};

					try {
						const response = await window.amlSdk.api.createClient(clientPayload);

						printResponse(response);
					}
					catch(err) {
						console.log(err);
					}
				}

				document.getElementById('create-control-procedure').onclick = async function(e) {
					printResponse();

					try {
						const response = await window.amlSdk.api.createControlProcedure({
							ns: NAMESPACE,
							id: USER_ID,
							contracts: [{
								contractId: 1,
								registeredAt: '2022-12-20',
								name: 'Testovací procedura #' + new Date().getMilliseconds(),
								clientRole: 'customer',
								arrangementMethod: 'in_person',
								contractType: 'one_off',
								contractKind: 'finalized',
								implementor: 'George Stevenson',
							}],
							procedure: {
								firstValidAt: '2022-12-20',
								yearlyFinancialVolume: 333,
								signing: {
									representedByAnother: false,
									clientAge: 30,
								},
								preScoring: {
									addressAtLabourOffice: false,
									foreignPerson: false,
									isPep: false,
									isSanctioned: false,
									riskyBusiness: false,
									identifiedInPerson: true,
								},
							},
						})

						printResponse(response);
					}
					catch(e) {
						console.log(e);
					}
				}

				document.getElementById('read-contract-questionnaire').onclick = async function(e) {
					printResponse();

					try {
						const response = await window.amlSdk.api.readContractQuestionnaire({
							ns: NAMESPACE,
							id: USER_ID,
							contractId: '--last--'
						})

						printResponse(response)
					}
					catch(e) {
						console.log(e);
					}
				}
			});
		</script>
	</head>
	<body>
		<h1>Ukázka SDK AML implementace</h1>
		<button id="open-questionnaire">Otevřít dotazník</button>
		<button id="create-client">Založ klienta</button>
		<button id="create-control-procedure">Vytvoř kontrolní proceduru</button>
		<button id="read-contract-questionnaire">Načti dotazník smlouvy</button>

		<div style="border: 1px solid black; margin: 20px;">
			<h3>Výsledek:</h3>

			<pre id="result-object">...</pre>
		</div>
	</body>
</html>
